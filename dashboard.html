<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Charmly Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin:0; padding:0; font-family:'Inter',sans-serif; transition: background 0.3s,color 0.3s;}
  :root {
    --bg-color:#f7f9fc;
    --text-color:#333;
    --accent-color:#0b3d91;
    --card-bg:#fff;
    --card-shadow:rgba(0,0,0,0.05);
  }
  body.dark { 
    --bg-color:#121212;
    --text-color:#eee;
    --accent-color:#4f8ef7;
    --card-bg:#1e1e1e;
    --card-shadow:rgba(0,0,0,0.4);
  }

  body { background: var(--bg-color); color: var(--text-color); height:100vh; display:flex; flex-direction:column; }

  #theme-toggle { position: fixed; top: 20px; right: 20px; padding:10px 15px; border-radius:12px; background: var(--accent-color); color:#fff; border:none; cursor:pointer; box-shadow:0 4px 12px rgba(11,61,145,0.3); transition:all 0.3s;}
  #theme-toggle:hover { transform:translateY(-2px); background:#0e4fbf;}

  /* Dashboard Layout */
  .dashboard { flex:1; display:flex; overflow:hidden; }
  .chat-pane { width:35%; min-width:300px; border-right:1px solid #ccc; padding:20px; display:flex; flex-direction:column; gap:15px; overflow-y:auto; background: var(--card-bg); }
  .chat-pane h2 { font-size:1.5rem; margin-bottom:10px; color: var(--accent-color);}
  .chat-pane textarea { width:100%; height:120px; padding:15px; border-radius:12px; border:1px solid #ccc; background: var(--card-bg); color: var(--text-color); resize: vertical; box-shadow:0 4px 12px var(--card-shadow); }
  .chat-pane textarea:focus { outline:none; border-color: var(--accent-color); box-shadow:0 6px 20px rgba(11,61,145,0.2);}
  .chat-pane button { padding:12px 25px; font-size:1.1rem; border-radius:12px; border:none; background: var(--accent-color); color:#fff; cursor:pointer; transition: all 0.3s ease; box-shadow:0 4px 12px rgba(11,61,145,0.3); }
  .chat-pane button:hover { background:#0e4fbf; transform:translateY(-2px); box-shadow:0 6px 16px rgba(11,61,145,0.4);}
  #response { background: var(--card-bg); padding:15px; border-radius:12px; flex:1; overflow-y:auto; white-space: pre-wrap; box-shadow:0 4px 12px var(--card-shadow); }

  .preview-pane { flex:1; border-left:1px solid #ccc; height:100%; background:#fff;}
  .preview-pane iframe { width:100%; height:100%; border:none; }

  /* Typing effect */
  .typing { border-right:2px solid var(--accent-color); white-space: pre-wrap; overflow-wrap: break-word; }

  /* Responsive */
  @media(max-width:900px){ .dashboard{flex-direction:column;} .chat-pane{width:100%;border-right:none;border-bottom:1px solid #ccc;} .preview-pane{flex:1; height:50vh; border-left:none;}}
</style>
</head>
<body>

<button id="theme-toggle">Toggle Dark Mode</button>

<div class="dashboard">
  <!-- Chat / AI Agent -->
  <div class="chat-pane">
    <h2>AI Chat</h2>
    <textarea id="prompt" placeholder="Describe your website..."></textarea>
    <button id="generate">Generate</button>
    <pre id="response"></pre>
  </div>

  <!-- Live Preview -->
  <div class="preview-pane">
    <iframe id="live-preview"></iframe>
  </div>
</div>

<script>
const promptInput = document.getElementById("prompt");
const responseBox = document.getElementById("response");
const iframe = document.getElementById("live-preview");
const themeToggle = document.getElementById("theme-toggle");

// Load prompt from landing page
promptInput.value = localStorage.getItem("ai-prompt") || "";

// Dark Mode Toggle
themeToggle.addEventListener("click", () => { document.body.classList.toggle("dark"); });

// Typing Effect
async function typeEffect(element, text){
  element.textContent="";
  element.classList.add("typing");
  for(let i=0;i<text.length;i++){
    element.textContent+=text[i];
    await new Promise(r=>setTimeout(r,15));
  }
  element.classList.remove("typing");
}

// Generate AI
async function generateAI(){
  const prompt = promptInput.value.trim();
  if(!prompt){ alert("Please enter a prompt!"); return; }

  localStorage.setItem("ai-prompt", prompt);
  responseBox.textContent="Generating AI response...";
  iframe.srcdoc = "<p>Loading preview...</p>";

  try{
    const res = await fetch("/api/ai-generate", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({prompt})
    });
    const data = await res.json();
    const aiHtml = data.output || "<p>No output</p>";

    await typeEffect(responseBox, aiHtml);

    // Update live preview
    iframe.srcdoc = aiHtml;
  }catch(err){
    console.error(err);
    responseBox.textContent="Error fetching AI response.";
  }
}

// Button click
document.getElementById("generate").addEventListener("click", generateAI);

// Auto-generate first AI response when dashboard loads
window.addEventListener("DOMContentLoaded", ()=>{
  if(promptInput.value.trim()!==""){
    generateAI();
  }
});
</script>

</body>
</html>
